<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <!--<link rel="stylesheet" href="css/bootstrap.css">-->
    <!--<link rel="stylesheet" href="css/font-awesome.css">-->
    <link rel="stylesheet" href="css/bootstrap.css">
    <!--<link rel="stylesheet" href="vendors/iconfonts/flag-icon-css/css/flag-icon.min.css">-->
    <!--<link rel="stylesheet" href="vendors/css/vendor.bundle.base.css">-->

    <link rel="stylesheet" href="css/styles.css"/>

    <link rel="stylesheet" href="css/search.css"/>
    <style>
        .navbar{
            position: fixed;
        }
        .navbar-inverse {
            background-color: #393D49;
            border-color: #393D49;
        }
        .input-group-btn:last-child > .btn, .input-group-btn:last-child > .btn-group {
            z-index: 2;
            margin-left: -1px;
            background: #fff;
        }

    </style>

    <script src="js/jquery-3.3.1.min.js"></script>
    <script src="js/jquery.cookie.js"></script>
    <script src="js/bootstrap.min.js"></script>




</head>
<body>
<!--<div id="name"></div>-->
<!--hello-->
<!--<input type="button" value="logout" id="logout">-->
<div class="total">
    <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
        <div class="container-fluid">
            <div class="navbar-header">
                <!--<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#sidebar-collapse">-->
                    <!--<span class="sr-only">Toggle navigation</span>-->
                    <!--<span class="icon-bar"></span>-->
                    <!--<span class="icon-bar"></span>-->
                    <!--<span class="icon-bar"></span>-->
                <!--</button>-->
                <a class="navbar-brand" href="#"><span><img src="images/logo.svg"></span></a>
                <ul class="user-menu">
                    <li class="dropdown pull-right">
                        <!--<a href="#" class="dropdown-toggle" data-toggle="dropdown"><span class="glyphicon glyphicon-user"></span> User <span class="caret"></span></a>-->
                        <a data-toggle="dropdown" class="dropdown-toggle" href="#">
                            <img class="img-circle" width="34" height="34" src="images/avatar-male.jpg" />John Smith<b class="caret"></b></a>

                        <ul class="dropdown-menu" role="menu">
                            <li><a href="#"><span class="glyphicon glyphicon-user"></span> Profile</a></li>
                            <li><a href="#"><span class="glyphicon glyphicon-cog"></span> Settings</a></li>
                            <li><a href="#"><span class="glyphicon glyphicon-log-out"></span> Logout</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div><!-- /.container-fluid -->
    </nav>

<!--<div class="layui-row layui-col-space3">-->
    <!--<div class="layui-col-md1">-->
        <!--&lt;!&ndash;<img src="img/itaem.png" height="30px" />&ndash;&gt;-->
        <!--WingCloud-->
    <!--</div>-->
    <!--<div class="layui-col-md2">-->
        <!--<input type="text" id="query" name="q" required lay-verify="required" placeholder="输入关键字" class="layui-input">-->
    <!--</div>-->
    <!--<div class="layui-col-md1">-->
        <!--<button id="btn2" onclick="upd()" class="layui-btn"> 搜索  </button>-->
    <!--</div>-->
<!--</div>-->
<!--&lt;!&ndash;横线&ndash;&gt;-->
<!--<hr class="layui-bg-red">-->

<!--&lt;!&ndash;搜索结果&ndash;&gt;-->
<!--<div id="result">-->
    <!--<hr class="layui-bg-gray">-->
<!--</div>-->
<!--<div id="page"></div>-->

<div id="top-image">
    <div id="content" class="container center-block">
        <div class="jumbotron">
            <div class="container">
                <h1>WingCloud</h1>
                <p>WingCloud分布式搜索引擎。</p>
                <div class="input-group input-group-lg">
                    <!--<span class="input-group-addon" id="sizing-addon1">-->
                        <!--<span class="glyphicon glyphicon-plus" aria-hidden="true"></span>-->
                        <div class="input-group-btn">
                            <button type="button"class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <span class="buttonText">搜索方式</span>
                                <span class="caret"></span>
                            </button>
                            <ul class="dropdown-menu">
                              <li><a href="#" onclick="shows($(this).text())">类别</a></li>
                              <li><a href="#" onclick="shows($(this).text())">自定义</a></li>
                            </ul>
                        </div><!-- /btn-group -->

                    <!--</span>-->
                    <input type="text" class="form-control" placeholder="输入关键词" aria-describedby="sizing-addon1"/>
                    <span class="input-group-btn">
                         <button class="btn btn-default" type="button">搜 索</button>
                    </span>
                </div>
                <!--<div class="layui-input-inline">-->
                 <!--<input type="text" name="title" required lay-verify="required" placeholder="请输入标题" autocomplete="off" class="layui-input">-->
                <!--</div>-->
                <!--<span class="layui-input-inline">-->
                    <!--<button class="layui-btn layui-btn-primary layui-btn-lg">小型按钮</button>-->
                <!--</span>-->
            </div>
    </div>
</div>
</div>
</div>
<!-- 注意：如果你直接复制所有代码到本地，上述js路径需要改成你本地的 -->
    <!--<script src="js/pop.min.js"></script>-->

    <!--<script src="vendors/js/vendor.bundle.addons.js"></script>-->
    <!-- endinject -->
    <!-- Plugin js for this page-->
    <!-- End plugin js for this page-->
    <!-- inject:js -->
    <!--<script src="js2/template.js"></script>-->
    <!-- endinject -->
    <!-- Custom js for this page-->
    <!--<script src="js2/dashboard.js"></script>-->
    <!--<script src="js2/todolist.js"></script>-->

<script>
    function shows(a) {
        $('.buttonText').text(a)
    }


    window.onload = function () {
        //var myname = $.cookie('myname'); // 读取 cookie

        $.ajax({
            xhrFields: {
                withCredentials: true
            },
            url:"http://localhost:8080/api/user/getusermsg",//请求地址
            data:{},//提交的数据
            contentType:"application/text",
            //contentType: "application/x-www-form-urlencoded; charset=utf-8",
            type:"post",//提交的方式
            dataType:"json", //返回类型 TEXT字符串 JSON XML
            // beforeSend: function(request) {
            //     request.setRequestHeader("Authorization", MyLocalStorage.Cache.get('cookieKey'));
            // },
            success:function(data){
                $("#name").html(data.user_name);
            },
            error:function(xhr, textStatus, errorThrown){
                //请求失败
                //通过状态码判断401
                // alert(xhr.status)
                // alert(xhr.readyState);
                // alert(textStatus);
                // if (xhr.status === 401) {
                //     alert('身份验证已过期，请重新登陆.');
                //     //返回首页
                //     window.location.href = 'http://localhost:63342/test/index.html?_ijt=5s2aqchoafa7q5126joj5blfc8';
                // }
                alert(xhr.status+' '+xhr.readyState+' '+textStatus);
            }
        })
    }

    $("#logout").click(function(){
        //alert(MyLocalStorage.Cache.get('cookieKey'))
        //第一步：取数据,这里用到了用户名和密码

        $.ajax({
            xhrFields: {
                withCredentials: true
            },
            url:"http://localhost:8080/api/user/logout",//请求地址
            data:{},//提交的数据
            contentType:"application/json",
            //contentType: "application/x-www-form-urlencoded; charset=utf-8",
            type:"post",//提交的方式
            dataType:"text", //返回类型 TEXT字符串 JSON XML
            // beforeSend: function(request) {
            //     request.setRequestHeader("Authorization", MyLocalStorage.Cache.get('cookieKey'));
            // },
            success:function(data){
                alert(data)
                window.location.href="login.html"
            },
            error:function(xhr, textStatus, errorThrown){
                //请求失败
                //通过状态码判断401
                // alert(xhr.status)
                // alert(xhr.readyState);
                // alert(textStatus);
                // if (xhr.status === 401) {
                //     alert('身份验证已过期，请重新登陆.');
                //     //返回首页
                //     window.location.href = 'http://localhost:63342/test/index.html?_ijt=5s2aqchoafa7q5126joj5blfc8';
                // }
                alert(xhr.status+' '+xhr.readyState+' '+textStatus);
            }
        })

    })





    function show(highlight, href) {
        //由于为Java集合 的 List 类型、 Array 类型共存，只能这样
        var i = 0;
        $.each(highlight, function(index, title) {
            var a = $("<a></a>").append(title.title[0]).attr("href", href[i].href[0]);
            a.attr("target", "_blank");
            var bq = $("<blockquote class='layui-elem-quote'>").append(a);
            var div = $("<div></div>").append(bq);
            $('#result').append("<hr />").append(div)
            i++;
        });
    }

    function upd() {
        var q = $("#query").val();
        $.ajax({
            type: "get",
            url: "http://localhost/test/select/" + q + "/0/5",
            success: function(result) {
                $('#result').empty()
                var highlight = result.highlight;
                var href = result.href;
                var total = result.total;
                show(highlight, href);
                //分页条再次渲染
                layui.use('laypage', function() {
                    //获取页模块
                    var laypage = layui.laypage;
                    //执行一个laypage实例
                    laypage.render({
                        //注意，这里的 page 是 ID，不用加 # 号
                        elem: 'page',
                        //数据总数，从服务端得到
                        count: total,
                        //每页的数据量
                        limit: 5,
                        //相连页数量
                        groups: 5
                    });
                });

            }
        });
    }


</script>
</body>
</html>